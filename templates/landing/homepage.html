<!DOCTYPE html>
{% extends "base_with_nav.html" %}
{% load static %}

{% block title %}

Homepage

{% endblock %}

{% block body %}

<div class="row-lg-12 homepage-content">
    
    <div class="col-lg-5">

      <div class="jumbotron">

        <h4 class="shooting-guide-title2">撮影した写真</h4>
        <hr>

        <div class="barcode_preview">
          <h5 class="shooting-guide-title2-header">バーコード撮影:</h5><br>
            
          {% for i in bcdimges %}
          
            <p class="shooting-guide-title2-content"> {{i}} </p>
          
          {% empty %}
          
            <div class="row">
              
              <div class="col-lg-3">
                <p class="shooting-guide-title2-content"> なし </p>
              </div>
              
              <div class="col-lg-9">
                <a href="#"> <button class="btn btn-primary"> <i class="fas fa-camera"></i> バーコードカメラ </button> </a>
              </div>
            
            </div>
            
            
          {% endfor %}
        
        </div>

        <br><hr><br>

        <div class="Hyoshi_satsuei_preview">
          
          <h5 class="shooting-guide-title2-header">表紙撮影:</h5><br>
          
          {% for i in hyosatimges %}

            <p class="shooting-guide-title2-content"> {{i}} </p>

          {% empty %}

            <div class="row">
                
              <div class="col-lg-3">
                <p class="shooting-guide-title2-content"> なし </p>
              </div>
              
              <div class="col-lg-9">
                <a href="#"> <button class="btn btn-primary"> <i class="fas fa-camera"></i> 表紙撮影カメラ </button> </a>
              </div>
            
            </div>

          {% endfor %}
        </div>
      
      </div>

    </div>

    <div class="col-lg-5">

      <h4 class="shooting-guide-title1">撮影案内</h4>

      <hr>
      
      <p class="warning-text">※バーコード写真を撮影してください</p>

      <p class="warning-text">※表紙撮影写真を撮影してください（必須）</p>
      
      <button class="home-skip-button">登録</button>

    </div>


</div>





  <script>
    function sound() {
        var se = document.getElementById('demo_sound');
        se.play();
    }

    //カメラ用意
    var video = document.getElementById('camera');
    const se = document.querySelector('#se');
    
    // カメラ設定
    const constraints = {
      audio: false,
      video: {
        width: 600,
        height: 600,
        facingMode: "environment"   // フロントカメラを利用する⇒user
      }
    };
    
    //カメラを<video>と同期
    navigator.mediaDevices.getUserMedia(constraints)
    .then( (stream) => {
      video.srcObject = stream;
      video.onloadedmetadata = (e) => {
        video.play();  
      };
    })
    .catch( (err) => {
      console.log(err.name + ": " + err.message);
    });
    
    //カウンターファンクション
    var kaisu = 0;
    function counter() {
        var count = document.getElementById('count');
        var c = parseInt(count.value)
        if(c == 1){
          //Annnoyの類似画像出力の際にともに出力した撮影した写真を消す
          var hyoushi_img = document.getElementById('hyoushi_img');
          hyoushi_img.style.display ="none";
          count.value = ++c;
        }else{
          count.value = ++c;
        }
    }
    //撮影ファンクション
    function take_picture() {
        //videoのstreamをcanvasに書き出す方法
            var canvas = document.getElementById('canvas');
            var ctx = canvas.getContext('2d');
            //videoの縦幅横幅を取得
            var w = video.offsetWidth;
            var h = video.offsetHeight;
            canvas.setAttribute("width", w);
            canvas.setAttribute("height", h);
            ctx.drawImage(video, 0, 0, w, h);
    
        //canvasをimgに書き出し
        var img = document.getElementById('img_data');
        img.value = canvas.toDataURL('image/jpg');

            var w = 180;
            var h = 180;
            canvas.setAttribute("width", w);
            canvas.setAttribute("height", h);
            ctx.drawImage(video, 0, 0, w, h);

      }
</script>

{% endblock %}